<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<title>Using a Deep Link to connect an App to a Custom Backend</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 8954 2022-01-20 10:10:25Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See https://docutils.sourceforge.io/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="using-a-deep-link-to-connect-an-app-to-a-custom-backend">
<h1 class="title">Using a Deep Link to connect an App to a Custom Backend</h1>

<div class="section" id="introduction">
<h1>Introduction</h1>
<p>Once you have your own wire-server set up and configured, you may want to use a client other than the web interface (webapp). There are a few ways to accomplish this:</p>
<ul class="simple">
<li><strong>Using a Deep Link</strong> (which this page is all about)</li>
<li>Registering your backend instance with the hosted SaaS backend for re-direction. For which you might need to talk to the folks &#64; Wire (the company).</li>
</ul>
<p>Assumptions:</p>
<ul class="simple">
<li>You have wire-server installed and working</li>
<li>You have a familiarity with JSON files</li>
<li>You can place a JSON file on an HTTPS supporting web server somewhere your users can reach.</li>
</ul>
<p>Supported client apps:</p>
<ul class="simple">
<li>iOS</li>
<li>Android</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Wire deeplinks can be used to redirect a mobile (Android, iOS) Wire app to a specific backend URL. Deeplinks have no further ability implemented at this stage.</p>
</div>
</div>
<div class="section" id="connecting-to-a-custom-backend-utilizing-a-deep-link">
<h1>Connecting to a custom backend utilizing a Deep Link</h1>
<p>A deep link is a special link a user can click on after installing wire, but before setting it up. This link instructs their wire client to connect to your wire-server, rather than wire.com.</p>
<div class="section" id="with-added-proxy">
<h2>With Added Proxy</h2>
<p>In addition to connect to a custom backend a user can specify a socks proxy to add another layer to the network and make the api calls go through the proxy.</p>
</div>
</div>
<div class="section" id="from-a-user-s-perspective">
<h1>From a user's perspective:</h1>
<ol class="arabic simple">
<li>First, a user installs the app from the store</li>
<li>The user clicks on a deep link, which is formatted similar to: <tt class="docutils literal"><span class="pre">wire://access/?config=https://eu-north2.mycustomdomain.de/configs/backend1.json</span></tt> (notice the protocol prefix: <tt class="docutils literal"><span class="pre">wire://</span></tt>)</li>
<li>The app will ask the user to confirm that they want to connect to a custom backend. If the user cancels, the app exits.</li>
<li>Assuming the user did not cancel, the app will download the file <tt class="docutils literal"><span class="pre">eu-north2.mycustomdomain.de/configs/backend1.json</span></tt> via HTTPS. If it can't download the file or the file doesn't match the expected structure, the wire client will display an error message (<em>'sInvalid link'</em>).</li>
<li>The app will memorize the various hosts (REST, websocket, team settings, website, support) specified in the JSON and use those when talking to your backend.</li>
<li>In the welcome page of the app, a &quot;pill&quot; (header) is shown at the top, to remind the user that they are now on a custom backend. A button &quot;Show more&quot; shows the URL of where the configuration was fetched from.</li>
</ol>
<div class="section" id="with-added-proxy-1">
<h2>With Added Proxy</h2>
<p>In addition to the previous points
7. The app will remember the (proxy host, proxy port, if the proxy need authentication)
8. In the login page the user will see new section to add the proxy credentials if the proxy need authentication</p>
</div>
</div>
<div class="section" id="from-the-administrator-s-your-perspective">
<h1>From the administrator's (your) perspective:</h1>
<p>You need to host two static files, then let your users know how to connect. There are three options listed (in order of recommendation) for hosting the static files.</p>
<p>Note on the meaning of the URLs used below:</p>
<dl class="docutils">
<dt><tt class="docutils literal">backendURL</tt></dt>
<dd>Use the backend API entrypoint URL, by convention <tt class="docutils literal"><span class="pre">https://nginz-https.&lt;domain&gt;</span></tt></dd>
<dt><tt class="docutils literal">backendWSURL</tt></dt>
<dd>Use the backend Websocket API entrypoint URL, by convention <tt class="docutils literal"><span class="pre">https://nginz-ssl.&lt;domain&gt;</span></tt></dd>
<dt><tt class="docutils literal">teamsURL</tt></dt>
<dd>Use the URL to the team settings part of the webapp, by convention <tt class="docutils literal"><span class="pre">https://teams.&lt;domain&gt;</span></tt></dd>
<dt><tt class="docutils literal">accountsURL</tt></dt>
<dd>Use the URL to the account pages part of the webapp, by convention <tt class="docutils literal"><span class="pre">https://account.&lt;domain&gt;</span></tt></dd>
<dt><tt class="docutils literal">blackListURL</tt></dt>
<dd>is used to disable old versions of Wire clients (mobile apps). It's a prefix URL to which e.g. <cite>/ios</cite> or <cite>/android</cite> is appended. Example URL for the wire.com production servers: <tt class="docutils literal"><span class="pre">https://clientblacklist.wire.com/prod</span></tt> and example json files: <a class="reference external" href="https://clientblacklist.wire.com/prod/android">android</a> and <a class="reference external" href="https://clientblacklist.wire.com/prod/ios">iPhone</a> .</dd>
<dt><tt class="docutils literal">websiteURL</tt></dt>
<dd>Is used as a basis for a few links within the app pointing to FAQs and troubleshooting pages for end users. You can leave this as <tt class="docutils literal"><span class="pre">https://wire.com</span></tt> or host your own alternative pages and point this to your own website with the equivalent pages references from within the app.</dd>
<dt><tt class="docutils literal">title</tt></dt>
<dd>Arbitrary string that may show up in a few places in the app. Should be used as an identifier of the backend servers in question.</dd>
</dl>
<div class="section" id="with-added-proxy-2">
<h2>With Added Proxy</h2>
<dl class="docutils">
<dt><tt class="docutils literal">apiProxy:host (optional)</tt></dt>
<dd>Is used to specify a proxy to be added to the network engine, so the API calls will go through it to add more security layer.</dd>
<dt><tt class="docutils literal">apiProxy:port (optional)</tt></dt>
<dd>Is used to specify the port number for the proxy when we create the proxy object in the network layer.</dd>
<dt><tt class="docutils literal">apiProxy:needsAuthentication (optional)</tt></dt>
<dd>Is used to specify if the proxy need an authentication, so we can show the section during the login to enter the proxy credentials.</dd>
</dl>
<div class="section" id="host-a-deeplink-together-with-your-wire-installation">
<h3>Host a deeplink together with your Wire installation</h3>
<p>As of release <tt class="docutils literal">2.117.0</tt> from <tt class="docutils literal"><span class="pre">2021-10-29</span></tt> (see <cite>release notes&lt;release-notes&gt;</cite>), you can configure your deeplink endpoints to match your installation and DNS records (see explanations above)</p>
<pre class="code yaml literal-block">
# override values for wire-server
# (e.g. under ./helm_vars/wire-server/values.yaml)
nginz:
  nginx_conf:
    deeplink:
      endpoints:
        backendURL: &quot;https://nginz-https.example.com&quot;
        backendWSURL: &quot;https://nginz-ssl.example.com&quot;
        teamsURL: &quot;https://teams.example.com&quot;
        accountsURL: &quot;https://account.example.com&quot;
        blackListURL: &quot;https://clientblacklist.wire.com/prod&quot;
        websiteURL: &quot;https://wire.com&quot;
      apiProxy: (optional)
        host: &quot;https://socks5.proxy.com&quot;
        port: 1080
        needsAuthentication: true
      title: &quot;My Custom Wire Backend&quot;
</pre>
<p>(As with any configuration changes, you need to apply them following your usual way of updating configuration (e.g. 'helm upgrade...'))</p>
<p>Now both static files should become accessible at the backend domain under <tt class="docutils literal">/deeplink.json</tt> and <tt class="docutils literal">deeplink.html</tt>:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">https://nginz-https.&lt;domain&gt;/deeplink.json</span></tt></li>
<li><tt class="docutils literal"><span class="pre">https://nginz-https.&lt;domain&gt;/deeplink.html</span></tt></li>
</ul>
</div>
<div class="section" id="host-a-deeplink-using-minio-deprecated">
<h3>Host a deeplink using minio (deprecated)</h3>
<p><em>If possible, prefer the option in the subsection above or below. This subsection is kept for backwards compatibility.</em></p>
<p><strong>If you're using minio</strong> installed using the ansible code from <a class="reference external" href="https://github.com/wireapp/wire-server-deploy/blob/master/ansible/">wire-server-deploy</a>, then the <a class="reference external" href="https://github.com/wireapp/wire-server-deploy/blob/master/ansible/minio.yml#L75-L88">minio ansible playbook</a> (make sure to override these variables) creates a json and a html file in the right format, and makes it accessible at <tt class="docutils literal"><span class="pre">https://assets.&lt;domain&gt;/public/deeplink.json</span></tt> and at <tt class="docutils literal"><span class="pre">https://assets.&lt;domain&gt;/public/deeplink.html</span></tt></p>
</div>
<div class="section" id="host-a-deeplink-file-using-your-own-web-server">
<h3>Host a deeplink file using your own web server</h3>
<p>Otherwise you need to create a <tt class="docutils literal">.json</tt> file, and host it somewhere users can get to. This <tt class="docutils literal">.json</tt> file needs to specify the URLs of your backend. For the production wire server that we host, the JSON would look like:</p>
<pre class="code json literal-block">
{
   &quot;endpoints&quot; : {
      &quot;backendURL&quot; : &quot;https://prod-nginz-https.wire.com&quot;,
      &quot;backendWSURL&quot; : &quot;https://prod-nginz-ssl.wire.com&quot;,
      &quot;blackListURL&quot; : &quot;https://clientblacklist.wire.com/prod&quot;,
      &quot;teamsURL&quot; : &quot;https://teams.wire.com&quot;,
      &quot;accountsURL&quot; : &quot;https://accounts.wire.com&quot;,
      &quot;websiteURL&quot; : &quot;https://wire.com&quot;
   },
   &quot;apiProxy&quot; : {
      &quot;host&quot; : &quot;https://socks5.proxy.com&quot;,
      &quot;port&quot; : 1080,
      &quot;needsAuthentication&quot; : true
   },
   &quot;title&quot; : &quot;Production&quot;
}
</pre>
<p><strong>IMPORTANT NOTE:</strong> Clients require <strong>ALL</strong> keys to be present in the JSON file; if some of these keys are irrelevant to your installation (e.g., you don't have a websiteURL) you can leave these values as indicated in the above example.</p>
<p>There is no requirement for these hosts to be consistent, e.g. the REST endpoint could be <cite>wireapp.pineapple.com</cite> and the team setting <cite>teams.banana.com</cite>. If you have been following this documentation closely, these hosts will likely be consistent in naming, regardless.</p>
<p>You now need to get a link referring to that <tt class="docutils literal">.json</tt> file to your users, prepended with <tt class="docutils literal"><span class="pre">wire://access/?config=</span></tt>. For example, you can save the above <tt class="docutils literal">.json</tt> file as <tt class="docutils literal"><span class="pre">https://example.com/wire.json</span></tt>, and save the following HTML content as <tt class="docutils literal"><span class="pre">https://example.com/wire.html</span></tt>:</p>
<pre class="code html literal-block">
&lt;html&gt;
  &lt;head&gt;&lt;/head&gt;
  &lt;body&gt;
    &lt;a href=&quot;wire://access/?config=https://example.com/wire.json&quot;&gt;link&lt;/a&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
</div>
</div>
<div class="section" id="next-steps">
<h1>Next steps</h1>
<p>Now, you can e.g. email or otherwise provide a link to the deeplink HTML page to your users on their mobile devices, and they can follow the above procedure, by clicking on <tt class="docutils literal">link</tt>.</p>
</div>
</div>
</body>
</html>
